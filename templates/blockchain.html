{% extends './layout.html' %}

{% block body %}

<!DOCTYPE html>
<html lang="en">
  <head>

    <link href="{{ url_for('static', filename='css/bloques.css' ) }}" rel="stylesheet">

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css"
    />
    <!-- Fontaswesone cdn -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- Style CSS -->
    <link href="{{ url_for('static', filename='css/style.css' ) }}" rel="stylesheet">
  </head>
  <body>
    <div id="wrapper">
      <div id="page-wrapper">
        <div class="row">
          <div class="col-lg-12">
            <h1>Bloque en cadenas : <h1 class="page-header" id="counter-label"> 0 </h1></h1>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-12">
            <div class="panel panel-default">
              <div class="panel-body">
                <button class="btn btn-danger"  id="click-div" >Minar bloques</button>
                <br>
                <!--
                {% for j in data.n %}
                  {% if j==1 %}-->
                      <blockchain  class="d-flex align-items-center"><!--
                        <block id="bloque" class="" data-bs-toggle="collapse" href="#Genesis-block" aria-expanded="false" aria-controls="Genesis-block">
                          <div class="">
                            <span class="">Block 1 </span>
                            <p class="text-muted">(Genesis block)</p>
                          </div>
                          <ul class="list-group list-group-flush">
                            <li class="list-group-item">
                              <h5>Hash</h5>
                              <span class="hash">{{data.hash_c[j]}}</span>
                              <h5>Hash of previous block</h5>
                              <span class="text-muted">0</span>
                            </li>
                            <li class="list-group-item">
                              <h6>Nonce</h6>
                              <span class="text-muted">0</span>
                            </li>
                            <li class="list-group-item">
                              <h6>Timestamp</h6>
                              <span class="text-muted">{{ data.timestamp[j]}}</span>
                            </li>
                          </ul>
                        </block>
                        <chain-link>
                          <i id="bloque" class="fas fa-link"></i>
                        </chain-link>
                      </blockchain>
                    {%else%}
                    <blockchain class="d-flex align-items-center">
                      <block class="" data-bs-toggle="collapse" aria-expanded="false" aria-controls="Genesis-block">
                        <div class="">
                          <span class="">Block {{ data.n[j-1]}}</span>
                          <p class="text-muted">{{ data.descripcion[j-1]}}</p>
                        </div>
                        <ul class="list-group list-group-flush">
                          <li class="list-group-item">
                            <h5>Hash</h5>
                            <span class="hash">{{data.hash_c[j]}}</span>
                            <h5>Hash of previous block</h5>
                            <span class="text-muted">{{data.hash_c[j-1]}}</span>
                          </li>
                          <li class="list-group-item">
                            <h6>Nonce</h6>
                            <span class="text-muted">0</span>
                          </li>
                          <li class="list-group-item">
                            <h6>Timestamp</h6>
                            <span class="text-muted">{{ data.timestamp[j-1]}}</span>
                          </li>
                        </ul>
                      </block>
                      <chain-link>
                        <i class="fas fa-link"></i>
                      </chain-link>-->
                    </blockchain>
                  <!--  {% endif %}
                {% endfor %}-->
             </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
              window.onload = function () {
                  let clickDiv = document.getElementById("click-div");
                  clickDiv.onclick = incrementClick;

                  let resetBtn = document.getElementById("reset-button");
                  resetBtn.onclick = resetCounter;
              }
              var counterVal = 0;
              incrementClick = function() {
                counter=0;
                if (counterVal<=0){
                  let blockchain = document.querySelector("blockchain");
                  val = `
                  {% for j in data.n %}
                  {% if j==1 %}
                  <block id="bloque" class="" data-bs-toggle="collapse" href="#Genesis-block" aria-expanded="false" aria-controls="Genesis-block">
                    <div class="">
                      <span class="">Block 1 </span>
                      <p class="text-muted">(Genesis block)</p>
                    </div>
                    <ul class="list-group list-group-flush">
                      <li class="list-group-item">
                        <h5>Hash</h5>
                        <span class="hash">{{data.hash_c[j]}}</span>
                        <h5>Hash of previous block</h5>
                        <span class="text-muted">0</span>
                      </li>
                      <li class="list-group-item">
                        <h6>Nonce</h6>
                        <span class="text-muted">0</span>
                      </li>
                      <li class="list-group-item">
                        <h6>Timestamp</h6>
                        <span class="text-muted">{{ data.timestamp[j]}}</span>
                      </li>
                    </ul>
                  </block>
                  {% endif %}
                  {% endfor %}
                  <i class="fas fa-link"></i>
                  `;
                  let block = document.createElement("block");
                  block.innerHTML = val;
                  blockchain.append(block);
                }else{
                  let blockchain_1 = document.querySelector("blockchain");
                  val1 = `
                  {% for j in range(2,1000) %}
                  {% if j>=1 %}
                  <br>
                  <block class="" data-bs-toggle="collapse" aria-expanded="false" aria-controls="Genesis-block">
                    <div class="">
                      <span class="">Block {{ data.n[j-1]}}</span>
                      <p class="text-muted">{{ data.descripcion[j-1]}}</p>
                    </div>
                    <ul class="list-group list-group-flush">
                      <li class="list-group-item">
                        <h5>Hash</h5>
                        <span class="hash">{{data.hash_c[j]}}</span>
                        <h5>Hash of previous block</h5>
                        <span class="text-muted">{{data.hash_c[j-1]}}</span>
                      </li>
                      <li class="list-group-item">
                        <h6>Nonce</h6>
                        <span class="text-muted">0</span>
                      </li>
                      <li class="list-group-item">
                        <h6>Timestamp</h6>
                        <span class="text-muted">{{ data.timestamp[j-1]}}</span>
                      </li>
                    </ul>
                  </block>
                  {% endif %}
                  {% endfor %}
                  <i class="fas fa-link"></i>
                  `;
                  let block_1 = document.createElement("block");
                  block_1.innerHTML = val1;
                  blockchain_1.append(block_1); 
                }
                  updateDisplay(++counterVal);
              }
              function resetCounter() {
                  counterVal = 0;
                  updateDisplay(counterVal);
              }
              function updateDisplay(val) {
                  document.getElementById("counter-label").innerHTML = val;
              }
      </script>
  </body>
</html>
{% endblock %}